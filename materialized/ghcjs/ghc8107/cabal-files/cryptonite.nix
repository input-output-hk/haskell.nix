{ system
  , compiler
  , flags
  , pkgs
  , hsPkgs
  , pkgconfPkgs
  , errorHandler
  , config
  , ... }:
  ({
    flags = {
      support_aesni = true;
      support_rdrand = true;
      support_pclmuldq = false;
      support_sse = false;
      integer-gmp = true;
      support_deepseq = true;
      old_toolchain_inliner = false;
      check_alignment = false;
      use_target_attributes = true;
    };
    package = {
      specVersion = "1.18";
      identifier = { name = "cryptonite"; version = "0.28"; };
      license = "BSD-3-Clause";
      copyright = "Vincent Hanquez <vincent@snarc.org>";
      maintainer = "vincent@snarc.org";
      author = "Vincent Hanquez <vincent@snarc.org>";
      homepage = "https://github.com/haskell-crypto/cryptonite";
      url = "";
      synopsis = "Cryptography Primitives sink";
      description = "A repository of cryptographic primitives.\n\n* Symmetric ciphers: AES, DES, 3DES, CAST5, Blowfish, Twofish, Camellia, RC4, Salsa, XSalsa, ChaCha.\n\n* Hash: SHA1, SHA2, SHA3, SHAKE, MD2, MD4, MD5, Keccak, Skein, Ripemd, Tiger, Whirlpool, Blake2\n\n* MAC: HMAC, KMAC, Poly1305\n\n* Asymmetric crypto: DSA, RSA, DH, ECDH, ECDSA, ECC, Curve25519, Curve448, Ed25519, Ed448\n\n* Key Derivation Function: PBKDF2, Scrypt, HKDF, Argon2, BCrypt, BCryptPBKDF\n\n* Cryptographic Random generation: System Entropy, Deterministic Random Generator\n\n* Data related: Anti-Forensic Information Splitter (AFIS)\n\nIf anything cryptographic related is missing from here, submit\na pull request to have it added. This package strives to be a\ncryptographic kitchen sink that provides cryptography for everyone.\n\nEvaluate the security related to your requirements before using.\n\nRead \"Crypto.Tutorial\" for a quick start guide.";
      buildType = "Simple";
    };
    components = {
      "library" = {
        depends = ((([
          (hsPkgs."bytestring" or (errorHandler.buildDepError "bytestring"))
          (hsPkgs."memory" or (errorHandler.buildDepError "memory"))
          (hsPkgs."basement" or (errorHandler.buildDepError "basement"))
          (hsPkgs."ghc-prim" or (errorHandler.buildDepError "ghc-prim"))
        ] ++ pkgs.lib.optional (!(compiler.isGhc && compiler.version.lt "8.0")) (hsPkgs."base" or (errorHandler.buildDepError "base"))) ++ pkgs.lib.optional (system.isWindows) (hsPkgs."Win32" or (errorHandler.buildDepError "Win32"))) ++ pkgs.lib.optional (compiler.isGhc && true && flags.integer-gmp) (hsPkgs."integer-gmp" or (errorHandler.buildDepError "integer-gmp"))) ++ pkgs.lib.optional (flags.support_deepseq) (hsPkgs."deepseq" or (errorHandler.buildDepError "deepseq"));
        libs = pkgs.lib.optional (system.isLinux) (pkgs."pthread" or (errorHandler.sysDepError "pthread")) ++ pkgs.lib.optional (system.isWindows) (pkgs."advapi32" or (errorHandler.sysDepError "advapi32"));
        buildable = if compiler.isGhc && compiler.version.lt "8.0"
          then false
          else true;
      };
      tests = {
        "test-cryptonite" = {
          depends = [
            (hsPkgs."base" or (errorHandler.buildDepError "base"))
            (hsPkgs."bytestring" or (errorHandler.buildDepError "bytestring"))
            (hsPkgs."memory" or (errorHandler.buildDepError "memory"))
            (hsPkgs."tasty" or (errorHandler.buildDepError "tasty"))
            (hsPkgs."tasty-quickcheck" or (errorHandler.buildDepError "tasty-quickcheck"))
            (hsPkgs."tasty-hunit" or (errorHandler.buildDepError "tasty-hunit"))
            (hsPkgs."tasty-kat" or (errorHandler.buildDepError "tasty-kat"))
            (hsPkgs."cryptonite" or (errorHandler.buildDepError "cryptonite"))
          ];
          buildable = true;
        };
      };
      benchmarks = {
        "bench-cryptonite" = {
          depends = [
            (hsPkgs."base" or (errorHandler.buildDepError "base"))
            (hsPkgs."bytestring" or (errorHandler.buildDepError "bytestring"))
            (hsPkgs."deepseq" or (errorHandler.buildDepError "deepseq"))
            (hsPkgs."memory" or (errorHandler.buildDepError "memory"))
            (hsPkgs."gauge" or (errorHandler.buildDepError "gauge"))
            (hsPkgs."random" or (errorHandler.buildDepError "random"))
            (hsPkgs."cryptonite" or (errorHandler.buildDepError "cryptonite"))
          ];
          buildable = true;
        };
      };
    };
  } // {
    src = pkgs.lib.mkDefault (pkgs.fetchurl {
      url = "http://hackage.haskell.org/package/cryptonite-0.28.tar.gz";
      sha256 = "74ad886ae3f7cd6cadecb596707e49df37b0170ceed313e382bd15b13132a5db";
    });
  }) // {
    package-description-override = "Name:                cryptonite\nversion:             0.28\nSynopsis:            Cryptography Primitives sink\nDescription:\n    A repository of cryptographic primitives.\n    .\n    * Symmetric ciphers: AES, DES, 3DES, CAST5, Blowfish, Twofish, Camellia, RC4, Salsa, XSalsa, ChaCha.\n    .\n    * Hash: SHA1, SHA2, SHA3, SHAKE, MD2, MD4, MD5, Keccak, Skein, Ripemd, Tiger, Whirlpool, Blake2\n    .\n    * MAC: HMAC, KMAC, Poly1305\n    .\n    * Asymmetric crypto: DSA, RSA, DH, ECDH, ECDSA, ECC, Curve25519, Curve448, Ed25519, Ed448\n    .\n    * Key Derivation Function: PBKDF2, Scrypt, HKDF, Argon2, BCrypt, BCryptPBKDF\n    .\n    * Cryptographic Random generation: System Entropy, Deterministic Random Generator\n    .\n    * Data related: Anti-Forensic Information Splitter (AFIS)\n    .\n    If anything cryptographic related is missing from here, submit\n    a pull request to have it added. This package strives to be a\n    cryptographic kitchen sink that provides cryptography for everyone.\n    .\n    Evaluate the security related to your requirements before using.\n    .\n    Read \"Crypto.Tutorial\" for a quick start guide.\nLicense:             BSD3\nLicense-file:        LICENSE\nCopyright:           Vincent Hanquez <vincent@snarc.org>\nAuthor:              Vincent Hanquez <vincent@snarc.org>\nMaintainer:          vincent@snarc.org\nCategory:            Cryptography\nStability:           experimental\nBuild-Type:          Simple\nHomepage:            https://github.com/haskell-crypto/cryptonite\nBug-reports:         https://github.com/haskell-crypto/cryptonite/issues\nCabal-Version:       1.18\ntested-with:         GHC==8.8.2, GHC==8.6.5, GHC==8.4.4, GHC==8.2.2, GHC==8.0.2\nextra-doc-files:     README.md CHANGELOG.md\nextra-source-files:  cbits/*.h\n                     cbits/aes/*.h\n                     cbits/ed25519/*.h\n                     cbits/decaf/include/*.h\n                     cbits/decaf/include/decaf/*.h\n                     cbits/decaf/include/arch_32/*.h\n                     cbits/decaf/include/arch_ref64/*.h\n                     cbits/decaf/p448/arch_32/*.h\n                     cbits/decaf/p448/arch_ref64/*.h\n                     cbits/decaf/p448/*.h\n                     cbits/decaf/ed448goldilocks/decaf_tables.c\n                     cbits/decaf/ed448goldilocks/decaf.c\n                     cbits/include32/p256/*.h\n                     cbits/include64/p256/*.h\n                     cbits/blake2/ref/*.h\n                     cbits/blake2/sse/*.h\n                     cbits/argon2/*.h\n                     cbits/argon2/*.c\n                     cbits/aes/x86ni_impl.c\n                     cbits/cryptonite_hash_prefix.c\n                     tests/*.hs\n\nsource-repository head\n  type: git\n  location: https://github.com/haskell-crypto/cryptonite\n\nFlag support_aesni\n  Description:       allow compilation with AESNI on system and architecture that supports it\n  Default:           True\n  Manual:            True\n\nFlag support_rdrand\n  Description:       allow compilation with RDRAND on system and architecture that supports it\n  Default:           True\n  Manual:            True\n\nFlag support_pclmuldq\n  Description:       Allow compilation with pclmuldq on architecture that supports it\n  Default:           False\n  Manual:            True\n\nFlag support_sse\n  Description:       Use SSE optimized version of (BLAKE2, ARGON2)\n  Default:           False\n  Manual:            True\n\nFlag integer-gmp\n  Description:       Whether or not to use GMP for some functions\n  Default:           True\n  Manual:            True\n\nFlag support_deepseq\n  Description:       add deepseq instances for cryptographic types\n  Default:           True\n  Manual:            True\n\nFlag old_toolchain_inliner\n  Description:       use -fgnu89-inline to workaround an old compiler / linker / glibc issue.\n  Default:           False\n  Manual:            True\n\nFlag check_alignment\n  Description:       extra check on alignment in C layers, which cause lowlevel assert errors. for debugging only.\n  Default:           False\n  Manual:            True\n\nFlag use_target_attributes\n  Description:       use GCC / clang function attributes instead of global target options.\n  Default:           True\n  Manual:            True\n\nLibrary\n  Exposed-modules:   Crypto.Cipher.AES\n                     Crypto.Cipher.AESGCMSIV\n                     Crypto.Cipher.Blowfish\n                     Crypto.Cipher.CAST5\n                     Crypto.Cipher.Camellia\n                     Crypto.Cipher.ChaCha\n                     Crypto.Cipher.ChaChaPoly1305\n                     Crypto.Cipher.DES\n                     Crypto.Cipher.RC4\n                     Crypto.Cipher.Salsa\n                     Crypto.Cipher.TripleDES\n                     Crypto.Cipher.Twofish\n                     Crypto.Cipher.Types\n                     Crypto.Cipher.Utils\n                     Crypto.Cipher.XSalsa\n                     Crypto.ConstructHash.MiyaguchiPreneel\n                     Crypto.Data.AFIS\n                     Crypto.Data.Padding\n                     Crypto.ECC\n                     Crypto.ECC.Edwards25519\n                     Crypto.Error\n                     Crypto.MAC.CMAC\n                     Crypto.MAC.Poly1305\n                     Crypto.MAC.HMAC\n                     Crypto.MAC.KMAC\n                     Crypto.Number.Basic\n                     Crypto.Number.F2m\n                     Crypto.Number.Generate\n                     Crypto.Number.ModArithmetic\n                     Crypto.Number.Nat\n                     Crypto.Number.Prime\n                     Crypto.Number.Serialize\n                     Crypto.Number.Serialize.LE\n                     Crypto.Number.Serialize.Internal\n                     Crypto.Number.Serialize.Internal.LE\n                     Crypto.KDF.Argon2\n                     Crypto.KDF.PBKDF2\n                     Crypto.KDF.Scrypt\n                     Crypto.KDF.BCrypt\n                     Crypto.KDF.BCryptPBKDF\n                     Crypto.KDF.HKDF\n                     Crypto.Hash\n                     Crypto.Hash.IO\n                     Crypto.Hash.Algorithms\n                     Crypto.OTP\n                     Crypto.PubKey.Curve25519\n                     Crypto.PubKey.Curve448\n                     Crypto.PubKey.MaskGenFunction\n                     Crypto.PubKey.DH\n                     Crypto.PubKey.DSA\n                     Crypto.PubKey.ECC.Generate\n                     Crypto.PubKey.ECC.Prim\n                     Crypto.PubKey.ECC.DH\n                     Crypto.PubKey.ECC.ECDSA\n                     Crypto.PubKey.ECC.P256\n                     Crypto.PubKey.ECC.Types\n                     Crypto.PubKey.ECDSA\n                     Crypto.PubKey.ECIES\n                     Crypto.PubKey.Ed25519\n                     Crypto.PubKey.Ed448\n                     Crypto.PubKey.RSA\n                     Crypto.PubKey.RSA.PKCS15\n                     Crypto.PubKey.RSA.Prim\n                     Crypto.PubKey.RSA.PSS\n                     Crypto.PubKey.RSA.OAEP\n                     Crypto.PubKey.RSA.Types\n                     Crypto.PubKey.Rabin.OAEP\n                     Crypto.PubKey.Rabin.Basic\n                     Crypto.PubKey.Rabin.Modified\n                     Crypto.PubKey.Rabin.RW\n                     Crypto.PubKey.Rabin.Types\n                     Crypto.Random\n                     Crypto.Random.Types\n                     Crypto.Random.Entropy\n                     Crypto.Random.EntropyPool\n                     Crypto.Random.Entropy.Unsafe\n                     Crypto.System.CPU\n                     Crypto.Tutorial\n  Other-modules:     Crypto.Cipher.AES.Primitive\n                     Crypto.Cipher.Blowfish.Box\n                     Crypto.Cipher.Blowfish.Primitive\n                     Crypto.Cipher.CAST5.Primitive\n                     Crypto.Cipher.Camellia.Primitive\n                     Crypto.Cipher.DES.Primitive\n                     Crypto.Cipher.Twofish.Primitive\n                     Crypto.Cipher.Types.AEAD\n                     Crypto.Cipher.Types.Base\n                     Crypto.Cipher.Types.Block\n                     Crypto.Cipher.Types.GF\n                     Crypto.Cipher.Types.Stream\n                     Crypto.Cipher.Types.Utils\n                     Crypto.Error.Types\n                     Crypto.Number.Compat\n                     Crypto.Hash.Types\n                     Crypto.Hash.Blake2\n                     Crypto.Hash.Blake2s\n                     Crypto.Hash.Blake2sp\n                     Crypto.Hash.Blake2b\n                     Crypto.Hash.Blake2bp\n                     Crypto.Hash.SHA1\n                     Crypto.Hash.SHA224\n                     Crypto.Hash.SHA256\n                     Crypto.Hash.SHA384\n                     Crypto.Hash.SHA512\n                     Crypto.Hash.SHA512t\n                     Crypto.Hash.SHA3\n                     Crypto.Hash.SHAKE\n                     Crypto.Hash.Keccak\n                     Crypto.Hash.MD2\n                     Crypto.Hash.MD4\n                     Crypto.Hash.MD5\n                     Crypto.Hash.RIPEMD160\n                     Crypto.Hash.Skein256\n                     Crypto.Hash.Skein512\n                     Crypto.Hash.Tiger\n                     Crypto.Hash.Whirlpool\n                     Crypto.Random.Entropy.Source\n                     Crypto.Random.Entropy.Backend\n                     Crypto.Random.ChaChaDRG\n                     Crypto.Random.SystemDRG\n                     Crypto.Random.Probabilistic\n                     Crypto.PubKey.Internal\n                     Crypto.PubKey.ElGamal\n                     Crypto.ECC.Simple.Types\n                     Crypto.ECC.Simple.Prim\n                     Crypto.Internal.ByteArray\n                     Crypto.Internal.Compat\n                     Crypto.Internal.CompatPrim\n                     Crypto.Internal.DeepSeq\n                     Crypto.Internal.Imports\n                     Crypto.Internal.Nat\n                     Crypto.Internal.Words\n                     Crypto.Internal.WordArray\n  if impl(ghc < 8.0)\n    Buildable: False\n  else\n    Build-depends:   base\n\n  Build-depends:     bytestring\n                   , memory >= 0.14.18\n                   , basement >= 0.0.6\n                   , ghc-prim\n  ghc-options:       -Wall -fwarn-tabs -optc-O3\n  if os(linux)\n    extra-libraries: pthread\n  default-language:  Haskell2010\n  cc-options:        -std=gnu99\n  if flag(old_toolchain_inliner)\n    cc-options:      -fgnu89-inline\n  C-sources:         cbits/cryptonite_chacha.c\n                   , cbits/cryptonite_salsa.c\n                   , cbits/cryptonite_xsalsa.c\n                   , cbits/cryptonite_rc4.c\n                   , cbits/cryptonite_cpu.c\n                   , cbits/p256/p256.c\n                   , cbits/p256/p256_ec.c\n                   , cbits/cryptonite_blake2s.c\n                   , cbits/cryptonite_blake2sp.c\n                   , cbits/cryptonite_blake2b.c\n                   , cbits/cryptonite_blake2bp.c\n                   , cbits/cryptonite_poly1305.c\n                   , cbits/cryptonite_sha1.c\n                   , cbits/cryptonite_sha256.c\n                   , cbits/cryptonite_sha512.c\n                   , cbits/cryptonite_sha3.c\n                   , cbits/cryptonite_md2.c\n                   , cbits/cryptonite_md4.c\n                   , cbits/cryptonite_md5.c\n                   , cbits/cryptonite_ripemd.c\n                   , cbits/cryptonite_skein256.c\n                   , cbits/cryptonite_skein512.c\n                   , cbits/cryptonite_tiger.c\n                   , cbits/cryptonite_whirlpool.c\n                   , cbits/cryptonite_scrypt.c\n                   , cbits/cryptonite_pbkdf2.c\n                   , cbits/ed25519/ed25519.c\n  include-dirs:      cbits\n                   , cbits/ed25519\n                   , cbits/decaf/include\n                   , cbits/decaf/p448\n\n  if arch(x86_64) || arch(aarch64)\n    include-dirs:      cbits/include64\n  else\n    include-dirs:      cbits/include32\n\n  if arch(x86_64) || arch(aarch64)\n    C-sources:         cbits/decaf/p448/arch_ref64/f_impl.c\n                     , cbits/decaf/p448/f_generic.c\n                     , cbits/decaf/p448/f_arithmetic.c\n                     , cbits/decaf/utils.c\n                     , cbits/decaf/ed448goldilocks/scalar.c\n                     , cbits/decaf/ed448goldilocks/decaf_all.c\n                     , cbits/decaf/ed448goldilocks/eddsa.c\n\n    include-dirs:      cbits/decaf/include/arch_ref64\n                     , cbits/decaf/p448/arch_ref64\n  else\n    C-sources:         cbits/decaf/p448/arch_32/f_impl.c\n                     , cbits/decaf/p448/f_generic.c\n                     , cbits/decaf/p448/f_arithmetic.c\n                     , cbits/decaf/utils.c\n                     , cbits/decaf/ed448goldilocks/scalar.c\n                     , cbits/decaf/ed448goldilocks/decaf_all.c\n                     , cbits/decaf/ed448goldilocks/eddsa.c\n\n    include-dirs:      cbits/decaf/include/arch_32\n                     , cbits/decaf/p448/arch_32\n\n  if arch(x86_64) || arch(aarch64)\n    C-sources: cbits/curve25519/curve25519-donna-c64.c\n  else\n    C-sources: cbits/curve25519/curve25519-donna.c\n\n  -- FIXME armel or mispel is also little endian.\n  -- might be a good idea to also add a runtime autodetect mode.\n  -- ARCH_ENDIAN_UNKNOWN\n  if (arch(i386) || arch(x86_64))\n    CPP-options: -DARCH_IS_LITTLE_ENDIAN\n\n  if arch(i386)\n    CPP-options: -DARCH_X86\n\n  if arch(x86_64)\n    CPP-options: -DARCH_X86_64\n\n  if flag(support_rdrand) && (arch(i386) || arch(x86_64)) && !os(windows)\n    CPP-options:    -DSUPPORT_RDRAND\n    Other-modules:  Crypto.Random.Entropy.RDRand\n    c-sources:      cbits/cryptonite_rdrand.c\n\n  if flag(support_aesni) && (os(linux) || os(freebsd) || os(osx)) && (arch(i386) || arch(x86_64))\n    CC-options:     -DWITH_AESNI\n    if !flag(use_target_attributes)\n      CC-options:     -mssse3 -maes\n    if flag(support_pclmuldq)\n      CC-options:   -DWITH_PCLMUL\n      if !flag(use_target_attributes)\n        CC-options:     -msse4.1 -mpclmul\n    C-sources:       cbits/aes/x86ni.c\n                   , cbits/aes/generic.c\n                   , cbits/aes/gf.c\n                   , cbits/cryptonite_aes.c\n  else\n    C-sources:       cbits/aes/generic.c\n                   , cbits/aes/gf.c\n                   , cbits/cryptonite_aes.c\n\n  if arch(x86_64) || flag(support_sse)\n    C-sources:      cbits/blake2/sse/blake2s.c\n                  , cbits/blake2/sse/blake2sp.c\n                  , cbits/blake2/sse/blake2b.c\n                  , cbits/blake2/sse/blake2bp.c\n    include-dirs: cbits/blake2/sse\n  else\n    C-sources:      cbits/blake2/ref/blake2s-ref.c\n                  , cbits/blake2/ref/blake2sp-ref.c\n                  , cbits/blake2/ref/blake2b-ref.c\n                  , cbits/blake2/ref/blake2bp-ref.c\n    include-dirs: cbits/blake2/ref\n\n  if arch(x86_64) || flag(support_sse)\n    CPP-options:    -DSUPPORT_SSE\n    if arch(i386)\n      CC-options:   -msse2\n\n  C-sources:      cbits/argon2/argon2.c\n  include-dirs:   cbits/argon2\n\n  if os(windows)\n    cpp-options:    -DWINDOWS\n    Build-Depends:  Win32\n    Other-modules:  Crypto.Random.Entropy.Windows\n    extra-libraries: advapi32\n  else\n    Other-modules:  Crypto.Random.Entropy.Unix\n\n  if impl(ghc) && flag(integer-gmp)\n    Build-depends:   integer-gmp\n\n  if flag(support_deepseq)\n    CPP-options:     -DWITH_DEEPSEQ_SUPPORT\n    Build-depends:   deepseq\n  if flag(check_alignment)\n    cc-options:     -DWITH_ASSERT_ALIGNMENT\n  if flag(use_target_attributes)\n    cc-options:     -DWITH_TARGET_ATTRIBUTES\n\nTest-Suite test-cryptonite\n  type:              exitcode-stdio-1.0\n  hs-source-dirs:    tests\n  Main-is:           Tests.hs\n  Other-modules:     BlockCipher\n                     ChaCha\n                     BCrypt\n                     BCryptPBKDF\n                     ECC\n                     ECC.Edwards25519\n                     ECDSA\n                     Hash\n                     Imports\n                     KAT_AES.KATCBC\n                     KAT_AES.KATECB\n                     KAT_AES.KATGCM\n                     KAT_AES.KATCCM\n                     KAT_AES.KATOCB3\n                     KAT_AES.KATXTS\n                     KAT_AES\n                     KAT_AESGCMSIV\n                     KAT_AFIS\n                     KAT_Argon2\n                     KAT_Blowfish\n                     KAT_CAST5\n                     KAT_Camellia\n                     KAT_Curve25519\n                     KAT_Curve448\n                     KAT_DES\n                     KAT_Ed25519\n                     KAT_Ed448\n                     KAT_CMAC\n                     KAT_HKDF\n                     KAT_HMAC\n                     KAT_KMAC\n                     KAT_MiyaguchiPreneel\n                     KAT_PBKDF2\n                     KAT_OTP\n                     KAT_PubKey.DSA\n                     KAT_PubKey.ECC\n                     KAT_PubKey.ECDSA\n                     KAT_PubKey.OAEP\n                     KAT_PubKey.PSS\n                     KAT_PubKey.P256\n                     KAT_PubKey.RSA\n                     KAT_PubKey.Rabin\n                     KAT_PubKey\n                     KAT_RC4\n                     KAT_Scrypt\n                     KAT_TripleDES\n                     KAT_Twofish\n                     ChaChaPoly1305\n                     Number\n                     Number.F2m\n                     Padding\n                     Poly1305\n                     Salsa\n                     Utils\n                     XSalsa\n  Build-Depends:     base >= 0 && < 10\n                   , bytestring\n                   , memory\n                   , tasty\n                   , tasty-quickcheck\n                   , tasty-hunit\n                   , tasty-kat\n                   , cryptonite\n  ghc-options:       -Wall -fno-warn-orphans -fno-warn-missing-signatures -rtsopts\n  default-language:  Haskell2010\n\nBenchmark bench-cryptonite\n  type:              exitcode-stdio-1.0\n  hs-source-dirs:    benchs\n  Main-is:           Bench.hs\n  Other-modules:     Number.F2m\n  Build-Depends:     base\n                   , bytestring\n                   , deepseq\n                   , memory\n                   , gauge\n                   , random\n                   , cryptonite\n  ghc-options:       -Wall -fno-warn-missing-signatures\n  default-language:  Haskell2010\n";
  }